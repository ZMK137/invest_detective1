<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Invest Detective Terminal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #131722;
            --card-color: #1e222d;
            --text-main: #d1d4dc;
            --text-dim: #787b86;
            --accent-blue: #2962ff;
            --accent-green: #089981;
            --accent-red: #f23645;
            --border-color: #2a2e39;
        }

        body { background-color: var(--bg-color); color: var(--text-main); font-family: 'Inter', sans-serif; overflow-x: hidden; }
        
        .sidebar { height: 100%; width: 0; position: fixed; z-index: 1000; top: 0; left: 0; background-color: var(--card-color); border-right: 1px solid var(--border-color); overflow-x: hidden; transition: 0.3s; padding-top: 60px; }
        .sidebar a { padding: 12px 20px; text-decoration: none; font-size: 14px; color: var(--text-dim); display: block; transition: 0.2s; font-weight: 500; cursor: pointer; }
        .sidebar a:hover, .sidebar a.active { color: var(--accent-blue); background: rgba(41, 98, 255, 0.05); border-right: 2px solid var(--accent-blue); }
        .sidebar .closebtn { position: absolute; top: 10px; right: 20px; font-size: 24px; color: var(--text-dim); }
        .open-btn { font-size: 20px; cursor: pointer; background: var(--card-color); color: var(--text-main); padding: 8px 12px; border: 1px solid var(--border-color); border-radius: 4px; position: fixed; top: 15px; left: 15px; z-index: 999; }
        #main-content { transition: margin-left .3s; padding: 20px; padding-top: 80px; }

        .dashboard-card { background: var(--card-color); border: 1px solid var(--border-color); border-radius: 4px; padding: 20px; margin-bottom: 20px; }
        .metric-item { padding: 10px 0; border-bottom: 1px solid var(--border-color); display: flex; justify-content: space-between; align-items: center; }
        .metric-name { font-size: 0.85rem; color: var(--text-dim); font-weight: 500; display: flex; align-items: center; gap: 6px; }
        .metric-val { font-family: 'Roboto Mono', monospace; font-weight: 700; font-size: 1rem; color: var(--text-main); }
        .metric-label-big { font-size: 0.75rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px; }
        .metric-val-big { font-family: 'Roboto Mono', monospace; font-weight: 700; font-size: 1.5rem; color: var(--text-main); }
        .val-good { color: var(--accent-green); } .val-bad { color: var(--accent-red); } .text-blue { color: var(--accent-blue); }
        .info-icon { font-size: 0.9rem; color: var(--text-dim); cursor: help; transition: 0.2s; }
        .info-icon:hover { color: var(--accent-blue); }
        .view-section { display: none; }
        .chart-img { width: 100%; border-radius: 2px; border: 1px solid var(--border-color); }
        .tooltip-inner { background-color: #2a2e39 !important; border: 1px solid #434651; color: #d1d4dc; font-family: 'Inter', sans-serif; text-align: left; padding: 10px; max-width: 280px; }
        .tooltip-arrow::before { border-top-color: #2a2e39 !important; }
        .form-control-dark { background: #2a2e39; border: 1px solid #363a45; color: white; border-radius: 4px; font-family: 'Roboto Mono'; }
        .form-control-dark:focus { background: #2a2e39; color: white; border-color: var(--accent-blue); box-shadow: none; }
        .btn-primary { background-color: var(--accent-blue); border: none; font-weight: 600; padding: 8px 20px; }
        .pricing-card { text-align: center; border: 1px solid var(--border-color); border-radius: 8px; padding: 30px; transition: transform 0.2s; }
        .pricing-card:hover { transform: translateY(-5px); border-color: var(--accent-blue); }
        .price-tag { font-size: 2.5rem; font-weight: 700; font-family: 'Roboto Mono'; margin: 20px 0; }
        .main-logo { font-family: 'Roboto Mono', monospace; font-weight: 700; font-size: 1.5rem; letter-spacing: -1px; margin-right: 20px; }
        .logo-blue { color: var(--accent-blue); }
    </style>
</head>
<body>

<div id="mySidebar" class="sidebar">
    <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
    <div class="ps-3 mb-4 mt-2">
        <span class="badge bg-secondary">PLAN FREE</span>
        <div class="small text-dim mt-1">Zużyto: {{ checks_used }}/500</div>
    </div>
    <a onclick="showSection('dashboard')" id="link-dashboard" class="active"><i class="bi bi-grid-1x2 me-2"></i> Dashboard</a>
    <a onclick="showSection('dcf')" id="link-dcf"><i class="bi bi-calculator me-2"></i> Raport DCF</a>
    <a onclick="showSection('fundamental')" id="link-fundamental"><i class="bi bi-bar-chart-steps me-2"></i> Fundamenty</a>
    <a onclick="showSection('charts')" id="link-charts"><i class="bi bi-graph-up me-2"></i> Wykresy</a>
    <hr class="border-secondary mx-3">
    <a onclick="showSection('subscription')" id="link-subscription" class="text-warning"><i class="bi bi-star-fill me-2"></i> Subskrypcja</a>
    <a onclick="showSection('login')" id="link-login"><i class="bi bi-person-circle me-2"></i> Zaloguj się</a>
</div>

<button class="open-btn" onclick="openNav()"><i class="bi bi-list"></i></button>

<div id="main-content">
    <div class="container-fluid px-3 mb-4">
        <div class="d-flex flex-wrap justify-content-between align-items-center gap-3">
            <div class="d-flex align-items-center">
                <div class="main-logo">INVEST<span class="logo-blue">DETECTIVE</span></div>
            </div>
            <form method="POST" class="d-flex gap-2 flex-grow-1" style="max-width: 400px;">
                <input type="text" name="ticker" class="form-control form-control-dark" placeholder="TICKER (np. CDR)..." required>
                <button type="submit" class="btn btn-primary">SZUKAJ</button>
            </form>
        </div>
    </div>

    {% if limit_reached %}
    <div class="container-fluid px-3">
        <div class="alert alert-danger text-center py-5" style="background: var(--card-color); border: 1px solid var(--accent-red); color: white;">
            <h1><i class="bi bi-lock-fill text-danger"></i></h1>
            <h2>Limit Dzienny Osiągnięty</h2>
            <p class="lead mb-4 text-dim">Wykorzystałeś 500 darmowych analiz dzisiaj.</p>
            <button onclick="showSection('subscription')" class="btn btn-primary btn-lg">Zobacz Ofertę</button>
        </div>
    </div>
    {% endif %}

    {% if result and not limit_reached %}
    <div class="container-fluid px-3">

        <div id="view-dashboard" class="view-section" style="display: block;">
            <div class="row g-3">
                <div class="col-lg-9">
                    <div class="dashboard-card p-0 overflow-hidden" style="height: 500px;">
                        <div id="tradingview_chart" style="height:100%; width:100%"></div>
                        <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
                        <script type="text/javascript">
                        new TradingView.widget({
                            "autosize": true, "symbol": "GPW:{{ result.ticker }}", "interval": "D", "timezone": "Europe/Warsaw",
                            "theme": "dark", "style": "1", "locale": "pl", "toolbar_bg": "#f1f3f6", "enable_publishing": false,
                            "allow_symbol_change": true, "container_id": "tradingview_chart"
                        });
                        </script>
                    </div>
                </div>
                <div class="col-lg-3">
                    <div class="dashboard-card text-center mb-3">
                        <div class="metric-label-big">CENA RYNKOWA</div>
                        <div class="metric-val-big">{{ result.current_price }} PLN</div>
                    </div>
                    <div class="dashboard-card text-center mb-3">
                        <div class="metric-label-big">KAPITALIZACJA</div>
                        <div class="metric-val-big text-white">{{ "{:,.2f}".format(result.mcap / 1000000000) }} mld</div>
                    </div>
                    <div class="dashboard-card text-center">
                        <div class="metric-label-big">RYZYKO (ML)</div>
                        <div class="metric-val-big {{ 'val-bad' if result.ml_prob > 50 else 'val-good' }}">{{ "{:.1f}".format(result.ml_prob) }}%</div>
                    </div>
                    {% if result.dcf %}
                    <div class="dashboard-card text-center mt-3" style="border-top: 2px solid var(--accent-blue)">
                        <div class="metric-label-big text-blue">FAIR VALUE (DCF)</div>
                        <div class="metric-val-big">{{ result.dcf.fair_value }}</div>
                        <div class="small mt-1 {{ 'val-good' if result.dcf.fair_value > result.current_price else 'val-bad' }}">
                            {{ "NIEDOWARTOŚCIOWANA" if result.dcf.fair_value > result.current_price else "PRZEWARTOŚCIOWANA" }}
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <div id="view-dcf" class="view-section">
            <h5 class="text-white mb-4">Raport Wyceny DCF</h5>
            {% if result.dcf %}
            <div class="row g-4">
                <div class="col-md-6">
                    <div class="dashboard-card">
                        <h6 class="text-secondary mb-4">ZAŁOŻENIA MODELU</h6>
                        <ul class="list-unstyled">
                            <li class="d-flex justify-content-between mb-2">
                                <span>Free Cash Flow: <i class="bi bi-info-circle info-icon ms-1" data-bs-toggle="tooltip" title="Wolne przepływy pieniężne (OCF - CapEx). Gotówka dostępna dla właścicieli."></i></span> 
                                <span class="font-monospace fw-bold">{{ "{:,.0f}".format(result.dcf.fcf) }}</span>
                            </li>
                            <li class="d-flex justify-content-between mb-2">
                                <span>CAGR Hist: <i class="bi bi-info-circle info-icon ms-1" data-bs-toggle="tooltip" title="Średnioroczny wzrost przychodów w przeszłości."></i></span> 
                                <span class="font-monospace fw-bold">{{ result.dcf.cagr_raw }}%</span>
                            </li>
                            <li class="d-flex justify-content-between mb-2">
                                <span>Growth Used: <i class="bi bi-info-circle info-icon ms-1" data-bs-toggle="tooltip" title="Przyjęty wzrost na 5 lat (max 15%)."></i></span> 
                                <span class="font-monospace fw-bold text-blue">{{ result.dcf.growth }}%</span>
                            </li>
                            <li class="d-flex justify-content-between mb-2">
                                <span>WACC: <i class="bi bi-info-circle info-icon ms-1" data-bs-toggle="tooltip" title="Koszt kapitału (10%). Oczekiwana stopa zwrotu."></i></span> 
                                <span class="font-monospace fw-bold">{{ result.dcf.wacc }}%</span>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="dashboard-card text-center py-5">
                        <div class="metric-label-big">INTRINSIC VALUE <i class="bi bi-info-circle info-icon ms-1" data-bs-toggle="tooltip" title="Wartość wewnętrzna (prawdziwa) akcji wynikająca z przyszłych zysków, a nie spekulacji."></i></div>
                        <div class="display-3 fw-bold text-white">{{ result.dcf.fair_value }}</div>
                        <div class="text-secondary">PLN / akcję</div>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>

        <div id="view-fundamental" class="view-section">
            <h5 class="text-white mb-4">Analiza Wskaźnikowa</h5>
            <div class="row g-4">
                <div class="col-md-3">
                    <div class="dashboard-card h-100">
                        <h6 class="text-blue text-uppercase fw-bold mb-3">Rentowność</h6>
                        <div class="metric-item">
                            <span class="metric-name">ROE <i class="bi bi-info-circle info-icon" data-bs-toggle="tooltip" title="Zwrot z kapitału. >10%"></i></span>
                            <span class="metric-val {{ 'val-good' if result.latest.ROE > 10 else 'val-bad' }}">{{ "{:.1f}".format(result.latest.ROE) }}%</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-name">ROA <i class="bi bi-info-circle info-icon" data-bs-toggle="tooltip" title="Zwrot z aktywów. >5%"></i></span>
                            <span class="metric-val">{{ "{:.1f}".format(result.latest.ROA) }}%</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-name">ROS <i class="bi bi-info-circle info-icon" data-bs-toggle="tooltip" title="Marża netto. Im wyżej tym lepiej."></i></span>
                            <span class="metric-val">{{ "{:.1f}".format(result.latest.ROS) }}%</span>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="dashboard-card h-100">
                        <h6 class="text-blue text-uppercase fw-bold mb-3">Płynność</h6>
                        <div class="metric-item">
                            <span class="metric-name">Current Ratio <i class="bi bi-info-circle info-icon" data-bs-toggle="tooltip" title="Płynność bieżąca. Norma 1.2-2.0"></i></span>
                            <span class="metric-val {{ 'val-good' if result.latest.Current_Ratio > 1.2 else 'val-bad' }}">{{ "{:.2f}".format(result.latest.Current_Ratio) }}</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-name">Dług/Aktywa <i class="bi bi-info-circle info-icon" data-bs-toggle="tooltip" title="Bezpiecznie < 50%"></i></span>
                            <span class="metric-val {{ 'val-good' if result.latest.Debt_Ratio < 0.5 else 'val-bad' }}">{{ "{:.0f}".format(result.latest.Debt_Ratio*100) }}%</span>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="dashboard-card h-100">
                        <h6 class="text-blue text-uppercase fw-bold mb-3">Forensic</h6>
                        <div class="metric-item">
                            <span class="metric-name">Z-Score <i class="bi bi-info-circle info-icon" data-bs-toggle="tooltip" title="<1.8 Bankructwo, >2.99 Bezpiecznie"></i></span>
                            <span class="metric-val {{ 'val-good' if result.latest.Z_Score_Val > 2.99 else 'val-bad' }}">{{ "{:.2f}".format(result.latest.Z_Score_Val) }}</span>
                        </div>
                        <div class="metric-item">
                            <span class="metric-name">F-Score <i class="bi bi-info-circle info-icon" data-bs-toggle="tooltip" title="Piotroski Score (0-9). >7 Silne fundamenty."></i></span>
                            <span class="metric-val {{ 'val-good' if result.f_score > 6 else 'val-bad' }}">{{ result.f_score }}/9</span>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="dashboard-card h-100 p-0 overflow-auto" style="max-height: 250px;">
                        <table class="table table-dark table-sm mb-0 small text-center">
                            <thead><tr><th>Rok</th><th>Zysk</th><th>Z-Score</th></tr></thead>
                            <tbody>
                                {% for row in result.history %}
                                <tr>
                                    <td>{{ row.Rok }}</td>
                                    <td class="{{ 'text-success' if row.Zysk_Netto > 0 else 'text-danger' }}">{{ "{:,.0f}".format(row.Zysk_Netto/1000000) }}</td>
                                    <td>{{ "{:.2f}".format(row.Z_Score_Val) }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-charts" class="view-section">
            <h5 class="text-white mb-4">Wykresy Analityczne</h5>
            <div class="row g-4">
                <div class="col-md-6"><div class="dashboard-card p-0"><img src="data:image/png;base64,{{ result.charts.z_score }}" class="chart-img"></div></div>
                <div class="col-md-6"><div class="dashboard-card p-0"><img src="data:image/png;base64,{{ result.charts.prof }}" class="chart-img"></div></div>
                <div class="col-md-6"><div class="dashboard-card p-0"><img src="data:image/png;base64,{{ result.charts.liq }}" class="chart-img"></div></div>
                <div class="col-md-6"><div class="dashboard-card p-0"><img src="data:image/png;base64,{{ result.charts.benford }}" class="chart-img"></div></div>
            </div>
        </div>

    </div>
    {% endif %}

    <div id="view-subscription" class="view-section container px-4">
        <h2 class="text-white fw-bold text-center mb-5">Plany Abonamentowe</h2>
        <div class="row g-4 justify-content-center">
            <div class="col-md-4">
                <div class="pricing-card">
                    <h4 class="text-secondary">STARTER</h4>
                    <div class="price-tag">0 zł<span class="price-period">/mc</span></div>
                    <ul class="list-unstyled text-dim mb-4 small text-start ps-4">
                        <li class="mb-2 text-white"><i class="bi bi-check-lg me-2 text-blue"></i> 500 analiz dziennie</li>
                        <li class="mb-2"><i class="bi bi-check-lg me-2 text-blue"></i> Podstawowe wskaźniki</li>
                    </ul>
                    <button class="btn btn-outline-light w-100">Twój Plan</button>
                </div>
            </div>
            <div class="col-md-4">
                <div class="pricing-card" style="border-color: var(--accent-blue); background: rgba(41, 98, 255, 0.05);">
                    <h4 class="text-blue">INVESTOR</h4>
                    <div class="price-tag">49 zł<span class="price-period">/mc</span></div>
                    <ul class="list-unstyled text-dim mb-4 small text-start ps-4">
                        <li class="mb-2 text-white"><i class="bi bi-check-lg me-2 text-blue"></i> Bez limitu</li>
                        <li class="mb-2 text-white"><i class="bi bi-check-lg me-2 text-blue"></i> Pełny Raport DCF</li>
                    </ul>
                    <button class="btn btn-primary w-100">Wybierz</button>
                </div>
            </div>
        </div>
    </div>

    <div id="view-login" class="view-section container px-4" style="max-width: 400px; margin-top: 50px;">
        <div class="dashboard-card">
            <h4 class="text-center text-white mb-4">Zaloguj się</h4>
            <form>
                <div class="mb-3"><label class="text-dim small mb-1">EMAIL</label><input type="email" class="form-control form-control-dark" placeholder="user@example.com"></div>
                <div class="mb-4"><label class="text-dim small mb-1">HASŁO</label><input type="password" class="form-control form-control-dark" placeholder="••••••"></div>
                <button type="button" class="btn btn-primary w-100">WEJDŹ</button>
            </form>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl)
    })
    function openNav() { document.getElementById("mySidebar").style.width = "240px"; document.getElementById("main-content").style.marginLeft = "240px"; }
    function closeNav() { document.getElementById("mySidebar").style.width = "0"; document.getElementById("main-content").style.marginLeft= "0"; }
    function showSection(sectionId) {
        document.querySelectorAll('.view-section').forEach(el => el.style.display = 'none');
        document.getElementById('view-' + sectionId).style.display = 'block';
        document.querySelectorAll('.sidebar a').forEach(el => el.classList.remove('active'));
        if(document.getElementById('link-' + sectionId)) { document.getElementById('link-' + sectionId).classList.add('active'); }
        if (window.innerWidth < 768) closeNav();
    }
</script>
</body>
</html>